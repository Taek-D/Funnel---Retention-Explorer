# Funnel & Retention Explorer

> CSV 하나로 퍼널 전환율, 코호트 리텐션, 세그먼트 비교, 구독 KPI까지 — 데이터 분석가를 위한 올인원 행동 분석 도구

**Live Demo**: [fre-analytics.vercel.app](https://fre-analytics-castletaek9643-9522s-projects.vercel.app)

---

## 왜 이 프로젝트를 만들었는가

데이터 분석 실무에서 반복적으로 마주하는 문제가 있었습니다:

- GA4나 Amplitude 같은 분석 도구는 **이미 연동된 서비스**에서만 작동합니다.
- 실제로 PM이나 마케터가 건네주는 데이터는 대부분 **CSV 파일**입니다.
- "이 데이터로 퍼널 분석 좀 해주세요"라는 요청이 들어오면, 매번 Python 스크립트를 작성하거나 스프레드시트에서 수작업으로 피벗 테이블을 만들어야 했습니다.

**Funnel & Retention Explorer**는 이 문제를 해결합니다. CSV 파일을 업로드하면 이커머스/구독 서비스 유형을 자동으로 감지하고, 퍼널 전환율 계산, 코호트 리텐션 분석, 세그먼트 비교(통계 검정 포함), 자동 인사이트 생성까지 한 번에 수행합니다.

---

## 분석 케이스 스터디

### Case 1: 이커머스 퍼널 분석 (3,000 이벤트)

**데이터**: 패션 커머스 앱의 이벤트 로그 (iOS/Android/Web, 6개 유입 채널, 3개국)

**퍼널 구성**: `view_item` → `add_to_cart` → `begin_checkout` → `purchase`

| 단계 | 사용자 수 | 단계별 전환율 | 이탈 수 |
|------|-----------|---------------|---------|
| view_item | 150명 | 100% | - |
| add_to_cart | 98명 | 65.3% | 52명 |
| begin_checkout | 72명 | 73.5% | 26명 |
| purchase | 58명 | 80.6% | 14명 |

**발견한 인사이트**:

1. **최대 이탈 지점은 view_item → add_to_cart (34.7% 이탈)**
   - 상품을 본 사용자 3명 중 1명이 장바구니에 담지 않음
   - 상품 상세 페이지의 CTA 강화 또는 가격 경쟁력 검토 필요

2. **플랫폼별 전환율 격차 17.2%p**
   - iOS 전환율이 Android 대비 유의미하게 높음
   - Android 앱의 결제 플로우 UX 점검이 우선 과제

3. **Organic 채널이 Paid Social 대비 12.4%p 높은 전환율**
   - 자연 유입 사용자의 구매 의도가 더 강함
   - 광고 크리에이티브의 기대치 관리 필요

### Case 2: 구독 서비스 분석 (3,000 이벤트)

**데이터**: 습관 형성 앱의 전체 라이프사이클 로그 (가입 → 온보딩 → 체험 → 구독 → 해지)

**퍼널 구성**: `app_open` → `signup` → `onboarding_complete` → `start_trial` → `subscribe`

| 단계 | 사용자 수 | 단계별 전환율 | 이탈 수 |
|------|-----------|---------------|---------|
| app_open | 263명 | 100% | - |
| signup | 199명 | 75.7% | 64명 |
| onboarding_complete | 146명 | 73.4% | 53명 |
| start_trial | 125명 | 85.6% | 21명 |
| subscribe | 86명 | 68.8% | 39명 |

**구독 KPI**:

| 지표 | 수치 | 해석 |
|------|------|------|
| Trial → Paid 전환율 | 68.8% | 업계 평균(40~60%) 상회, 양호 |
| ARPPU | $18.92 | Monthly 기준 적정 수준 |
| Paid Churn Rate | 23.4% | 개선 필요 (목표: 10% 이하) |
| 주요 해지 사유 | too_expensive (32%) | 가격 정책 재검토 필요 |
| D7 유료 리텐션 | 84.2% | 양호 |
| D30 유료 리텐션 | 61.8% | 주의 (목표: 70%) |

**발견한 인사이트**:

1. **Trial 전환은 우수하나 Churn이 높음** — "가입은 잘 시키지만 유지를 못 하는" 전형적 패턴
2. **해지 사유 1위가 "too_expensive"** — 가격 자체보다 **인지된 가치**의 문제일 가능성. 구독 후 첫 30일 이내 핵심 기능 사용 유도 필요
3. **D30 리텐션 급락** — 구독 후 30일 시점에 참여 캠페인 또는 새 콘텐츠 도입이 효과적일 수 있음

---

## 분석 방법론

### 1. 퍼널 전환율 (Funnel Conversion)

**방식**: 사용자 수준(User-level) 순차 퍼널

```
각 단계의 사용자 = 이전 단계를 완료한 사용자 중, 현재 단계 이벤트가 있는 사용자
전환율 = (현재 단계 사용자 수 / 이전 단계 사용자 수) × 100
이탈 수 = 이전 단계 사용자 수 - 현재 단계 사용자 수
```

- **중복 제거**: Set 기반으로 사용자별 1회만 카운트
- **중간 소요 시간**: 각 사용자의 전후 단계 이벤트 시간 차이의 **중앙값(Median)** 사용 (평균은 이상치에 민감하므로)
- **Fuzzy Matching**: 이벤트명이 정확히 일치하지 않아도 부분 문자열 매칭으로 자동 감지 (`add_to_cart` ≈ `addtocart`)

### 2. 코호트 리텐션 (Cohort Retention)

**Activity Retention** (일반):
```
코호트 = 특정 날짜에 코호트 이벤트를 수행한 사용자 그룹
Dn 리텐션 = (코호트 형성 후 n일에 활성 이벤트를 수행한 사용자 수 / 코호트 크기) × 100
```
- D0~D14까지 일별 추적
- 코호트 이벤트와 활성 이벤트를 개별 설정 가능

**Paid Retention** (구독):
```
코호트 = 동일한 날짜에 최초 구독(subscribe)한 사용자 그룹
Dn 유지 = 구독 후 n일이 지난 시점에 해지하지 않은 사용자 비율
```
- D0 / D7 / D14 / D30 / D60 / D90 추적
- 해지(cancel) 이벤트 발생 시 해당 시점 이후 이탈 처리

### 3. 세그먼트 비교 + 통계 검정

**비교 대상**: 플랫폼별(iOS, Android, Web), 채널별(Organic, Paid Social, Referral 등)

**전환율 비교**:
```
세그먼트 전환율 = (세그먼트 내 최종 단계 도달 사용자 / 세그먼트 내 첫 단계 사용자) × 100
Uplift = 세그먼트 전환율 - 전체 평균 전환율
```

**통계적 유의성**: Two-proportion Z-test
```
Z = (p₁ - p₂) / √[ p̂(1-p̂)(1/n₁ + 1/n₂) ]

여기서:
  p₁ = 세그먼트 전환율, p₂ = 전체 전환율
  p̂ = (x₁ + x₂) / (n₁ + n₂)  (Pooled proportion)
  p-value = 2 × (1 - Φ(|Z|))  (양측 검정)
```

p-value < 0.05이면 해당 세그먼트의 성과 차이가 통계적으로 유의미합니다.
이를 통해 "iOS가 진짜 더 좋은 건지, 단순 샘플 크기 차이인지"를 판단합니다.

### 4. 자동 인사이트 엔진

데이터 업로드 시 최대 **13가지 인사이트**를 자동 생성합니다:

| # | 인사이트 | 트리거 조건 | 비즈니스 의미 |
|---|----------|-------------|---------------|
| 1 | 최대 이탈 지점 | 퍼널 내 최저 전환율 단계 | UX 개선 우선순위 |
| 2 | 플랫폼 성과 격차 | 전환율 차이 > 10%p | 플랫폼별 버그/UX 점검 |
| 3 | 채널 성과 편차 | 전환율 차이 > 15%p | 마케팅 예산 재배분 근거 |
| 4 | D1 리텐션 경고 | D1 < 25% | 온보딩 개선 시급 |
| 5 | 리텐션 급락 지점 | 연속 일간 최대 하락폭 > 5%p | 참여 캠페인 타이밍 |
| 6 | 모범 세그먼트 | 최고 전환율 세그먼트 | 성공 요인 분석 대상 |
| 7 | Trial 전환율 | < 35% | 체험 가치 전달 부족 |
| 8 | 전환 결정 지연 | 중앙값 > 10일 | 체험 기간 최적화 |
| 9 | 결제 실패율 | > 10% | 결제 인프라 점검 |
| 10 | 높은 해지율 | Churn > 20% | 이탈 방어 필요 |
| 11 | 해지 사유 분석 | 특정 사유 > 20% | 맞춤 개선안 도출 |
| 12 | D7 유료 리텐션 | < 70% | 초기 온보딩 강화 |
| 13 | D30 유료 리텐션 | < 50% | 장기 가치 전달 필요 |

각 인사이트에는 **3가지 실행 가능한 권장 사항**(Actionable Recommendations)이 포함됩니다.

### 5. 구독 KPI 계산

| KPI | 산식 |
|-----|------|
| ARPPU | 총 매출 / 유료 사용자 수 |
| Churn Rate | 해지 사용자 / 유료 사용자 × 100 |
| Trial Conversion | 구독 전환 사용자 / 체험 시작 사용자 × 100 |
| Plan Mix | 월간/연간 구독 비율 (subscribe + renew 이벤트 기준) |
| Renew Success | 갱신 성공 / (갱신 성공 + 결제 실패) × 100 |

---

## 주요 기능

### 데이터 처리
- **3단계 업로드 UX**: 드래그 앤 드롭 → 자동 컬럼 매핑 → 품질 리포트
- **데이터 유형 자동 감지**: 이벤트 패턴 매칭으로 이커머스/구독 서비스 자동 판별
- **유연한 컬럼 매핑**: `timestamp`, `user_id`, `event_name` 등 다양한 컬럼명을 자동 인식

### 분석
- **퍼널 분석**: 템플릿 기반 + 커스텀 퍼널 구성, 단계별 전환율/이탈/소요시간
- **코호트 리텐션**: Activity Retention (D0~D14) + Paid Retention (D0~D90) 히트맵
- **세그먼트 비교**: 플랫폼/채널별 전환율 비교 + p-value 통계 검정
- **구독 분석**: 트라이얼 전환, 해지율, 플랜 믹스, 해지 사유 Top 5
- **자동 인사이트**: 13가지 패턴 기반 + AI 요약 (Gemini 2.0 Flash)

### 프로덕트
- **인증**: Supabase Auth 기반 회원가입/로그인 + 게스트 모드
- **클라우드 저장**: 프로젝트/데이터셋/분석 스냅샷 저장 (RLS 보안)
- **리포트 내보내기**: 분석 결과 PNG 리포트 (AI 요약 포함, 자동 페이지 분할)
- **글로벌 검색**: `Cmd+K`로 페이지/인사이트/이벤트 통합 검색

---

## 기술 스택

| 영역 | 기술 |
|------|------|
| Frontend | React 19, TypeScript 5.8, Vite 6 |
| 차트 | Recharts (BarChart, AreaChart) |
| 스타일 | Tailwind CSS (다크 테마, Glassmorphism) |
| CSV 파싱 | PapaParse |
| 인증/DB | Supabase (Auth + PostgreSQL + RLS) |
| AI | Gemini 2.0 Flash API |
| 테스트 | Vitest (단위 2 + 통합 7) |
| 배포 | Vercel (GitHub 자동 배포) |

### 아키텍처

```
CSV File → PapaParse → dataProcessor (자동 감지) → AppContext (useReducer)
                                                          │
                    ┌─────────────────────────────────────┘
                    ▼
              Custom Hooks
     ┌──────────┬──────────┬──────────┬──────────┐
     ▼          ▼          ▼          ▼          ▼
  Funnel    Retention   Segment   Subscription  Insights
  Engine     Engine      Engine     Engine       Engine
     │          │          │          │          │
     └──────────┴──────────┴──────────┴──────────┘
                           │
                    Pages (Dashboard, Analysis, ...)
```

**설계 원칙**:
- `lib/`: 순수 TypeScript 분석 엔진 (React 비의존) — 독립 테스트 가능
- `hooks/`: lib ↔ React 상태를 연결하는 브릿지
- `context/`: `useReducer` 기반 전역 상태 (Redux 없이 경량화)
- `pages/`: hooks를 소비하는 UI 레이어

이 구조 덕분에 분석 로직만 별도로 테스트할 수 있으며, 향후 다른 프레임워크로의 마이그레이션도 용이합니다.

---

## 테스트

```bash
cd "funnel-&-retention-explorer frontend"
npm test
```

| 유형 | 테스트 수 | 검증 범위 |
|------|-----------|-----------|
| 단위 테스트 | 2 | dataProcessor (자동 감지), formatters (숫자/통화/퍼센트) |
| 통합 테스트 | 7 | CSV 파싱 → 데이터 처리 → 분석 엔진 전체 파이프라인 |

통합 테스트는 **실제 3,000건 샘플 데이터**를 사용하여 이커머스/구독 양쪽의 전체 분석 파이프라인을 검증합니다.

---

## 실행 방법

```bash
# React Frontend (권장)
cd "funnel-&-retention-explorer frontend"
npm install
npm run dev          # http://localhost:3000

# 환경 변수 (선택 - 없어도 게스트 모드로 분석 가능)
# .env 파일에 설정:
# VITE_SUPABASE_URL=...
# VITE_SUPABASE_ANON_KEY=...
# VITE_GEMINI_API_KEY=...
```

**샘플 데이터**로 즉시 체험 가능:
- `샘플 데이터/sample_ecommerce_events_3000.csv` — 이커머스 (패션 커머스)
- `샘플 데이터/sample_subscription_events_3000.csv` — 구독 서비스 (습관 형성 앱)

---

## 이 프로젝트에서 증명하는 역량

| 역량 | 구현 |
|------|------|
| **퍼널 분석** | User-level 순차 퍼널, 중앙값 소요시간, Fuzzy 이벤트 매칭 |
| **코호트 분석** | Activity/Paid 이중 리텐션, 날짜 기반 코호트 그룹핑 |
| **통계 분석** | Two-proportion Z-test, Pooled proportion, p-value 기반 의사결정 |
| **구독 지표** | ARPPU, MRR, Churn Rate, Trial Conversion, Plan Mix |
| **데이터 시각화** | Recharts 기반 인터랙티브 차트, 코호트 히트맵 |
| **인사이트 도출** | 임계값 기반 자동 감지 + 실행 가능한 권장 사항 |
| **데이터 엔지니어링** | CSV 파싱, 자동 스키마 감지, 데이터 품질 리포트 |
| **프로덕트 설계** | 3단계 UX 플로우, SaaS 아키텍처 (Auth + DB + AI) |

---

## 라이선스

이 프로젝트는 개인 및 상업적 용도로 자유롭게 사용할 수 있습니다.
