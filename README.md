# 📊 퍼널 & 리텐션 분석

사용자 행동 데이터를 분석하여 전환 퍼널과 리텐션 코호트를 시각화하는 고급 분석 대시보드입니다.

![메인 화면](https://via.placeholder.com/800x400?text=Funnel+%26+Retention+Explorer)

## ✨ 주요 기능

### 📤 데이터 업로드 및 관리
- **CSV 파일 업로드**: 드래그 앤 드롭 또는 클릭하여 파일 선택
- **🆕 진행률 표시**: 데이터 처리 중 실시간 진행 상황 및 단계별 상태 표시
- **🆕 자동 유형 감지**: 이벤트 패턴을 분석하여 이커머스/구독 서비스 자동 인식
- **최근 파일 기록**: 최근 5개 파일 자동 저장 및 빠른 재로드
- **자동 컬럼 매핑**: 일반적인 컬럼명 자동 인식
- **데이터 미리보기**: 처음 10행 테이블 미리보기
- **🆕 자동 탭 초기화**: 새 파일 업로드 시 이전 분석 결과 자동 초기화

### 🔽 퍼널 분석
- **🆕 자동 템플릿 적용**: 감지된 데이터 유형에 따라 퍼널 템플릿 자동 로드
- **다단계 퍼널 구성**: 원하는 이벤트로 퍼널 단계 설정
- **전환율 계산**: 각 단계별 사용자 수, 전환율, 이탈 수 분석
- **소요 시간 분석**: 단계 간 중간 소요 시간 측정
- **시각화**: 인터랙티브 차트로 퍼널 시각화

### 📈 리텐션 코호트 분석
- **코호트 구성**: 첫 이벤트 기준으로 코호트 생성
- **일별 리텐션**: D0~D14 리텐션율 계산 및 매트릭스 표시
- **주요 지표**: D1, D7, D14 리텐션 평균값
- **리텐션 곡선**: 시간 경과 추이 차트

### 🔍 세그먼트 비교
- **플랫폼별 분석**: iOS, Android 등 플랫폼별 성과 비교
- **채널별 분석**: 유입 채널별 전환율 비교
- **시각적 비교**: 막대 차트로 세그먼트 성과 표시

### 💡 자동 인사이트
- **🆕 전체 데이터 기반 분석**: 업로드 즉시 전체 데이터로 자동 인사이트 생성
- **최대 이탈 지점 감지**: 퍼널에서 가장 큰 이탈 발생 단계 식별
- **플랫폼 성과 격차**: 플랫폼 간 전환율 차이 분석 (10%p 이상 차이 경고)
- **채널 성과 편차**: 채널별 성과 차이 및 예산 재분배 제안 (15%p 이상 차이 경고)
- **D1 리텐션 경고**: 낮은 초기 리텐션 감지 및 개선 제안 (25% 미만 경고)
- **리텐션 급락 지점**: 가장 큰 리텐션 하락 발생 시기 식별
- **모범 사례 세그먼트**: 최고 성과 세그먼트 분석 (10% 이상 전환율)

### 📷 리포트 내보내기 (PNG)
- **🆕 PNG 이미지 형식**: PDF 대신 PNG로 내보내기 (환경 제약 최소화)
- **🆕 제한 환경 대응**: iframe, webview, iOS Safari 등에서도 동작
  - 다운로드 가능 환경: 자동 PNG 다운로드
  - 다운로드 차단 환경: 새 탭으로 이미지 열기 → 사용자가 저장/공유
- **멀티페이지 지원**: 리포트가 길면 A4 단위로 자동 분할 (page_1, page_2...)
- **한글 완벽 지원**: Canvas 텍스트 렌더링 + 자동 줄바꿈
- **차트 포함**: 퍼널, 리텐션, 세그먼트 차트를 배경과 함께 이미지화
- **포함 내용**:
  - 데이터 품질 요약 (행수, 사용자수, 날짜 범위)
  - 퍼널 분석 결과 및 차트
  - 리텐션 코호트 요약 및 차트
  - 세그먼트 비교 결과 및 차트
  - 핵심 인사이트 (최대 5개)

### 📧 n8n 이메일 연동
- **🆕 자동 이메일 발송**: n8n webhook을 통한 리포트 이메일 전송
- **간편한 설정**: 웹 UI에서 webhook URL과 수신자 설정
- **멀티 수신자**: 쉼표로 구분하여 여러 이메일 주소 지정
- **자동 발송 옵션**: 분석 완료 시 자동으로 이메일 발송
- **연결 테스트**: webhook 연결 상태 실시간 확인
- **base64 첨부**: PNG 리포트를 base64로 인코딩하여 전송
- **🚀 원클릭 설정**: [n8n-workflow-template.json](./n8n-workflow-template.json) import로 즉시 시작
- **빠른 시작**: [N8N_QUICKSTART.md](./N8N_QUICKSTART.md) (5분 설정)
- **상세 가이드**: [N8N_WORKFLOW_GUIDE.md](./N8N_WORKFLOW_GUIDE.md) (완벽 매뉴얼)


## 🚀 시작하기

### 실행 방법

이 프로그램은 순수 HTML/CSS/JavaScript로 구성되어 별도의 설치가 필요 없습니다.

1. **로컬 실행**
   ```bash
   # 프로젝트 디렉토리로 이동
   cd "Funnel & Retention Explorer"
   
   # 브라우저에서 index.html 열기
   open index.html
   ```

2. **웹 서버 사용** (권장)
   ```bash
   # Python 내장 웹 서버 사용
   python -m http.server 8000
   
   # 브라우저에서 http://localhost:8000 접속
   ```

### 필요한 데이터 형식

CSV 파일에는 다음 컬럼이 포함되어야 합니다:

| 컬럼 | 필수 | 설명 | 예시 |
|------|------|------|------|
| **timestamp** | ✅ | 이벤트 발생 시간 | 2023-01-01 10:00:00 |
| **user_id** | ✅ | 사용자 고유 ID | user_12345 |
| **event_name** | ✅ | 이벤트 이름 | view_item, purchase |
| **session_id** | ⭕ | 세션 ID | session_abc123 |
| **platform** | ⭕ | 플랫폼 | ios, android, web |
| **channel** | ⭕ | 유입 채널 | google, facebook, organic |

**CSV 예시:**

**이커머스 데이터:**
```csv
timestamp,user_id,event_name,session_id,platform,channel
2023-01-01 10:00:00,user1,view_item,sess1,ios,google
2023-01-01 10:05:00,user1,add_to_cart,sess1,ios,google
2023-01-01 10:10:00,user1,begin_checkout,sess1,ios,google
2023-01-01 10:15:00,user1,purchase,sess1,ios,google
```

**구독 서비스 데이터:**
```csv
timestamp,user_id,event_name,session_id,platform,channel
2023-01-01 10:00:00,user1,app_open,sess1,android,organic
2023-01-01 10:05:00,user1,signup,sess1,android,organic
2023-01-01 10:10:00,user1,onboarding_complete,sess1,android,organic
2023-01-01 10:15:00,user1,start_trial,sess1,android,organic
2023-01-01 10:20:00,user1,subscribe,sess1,android,organic
```

## 📁 파일 구조

```
Funnel & Retention Explorer/
├── index.html                      # 메인 HTML 파일
├── app.js                         # 핵심 로직 및 데이터 처리
├── charts.js                      # Chart.js 차트 렌더링
├── styles.css                     # 스타일시트
├── pdf_font_noto_sans_kr.js      # 한글 폰트 (레거시)
├── README.md                      # 이 파일
├── PNG_EXPORT_IMPLEMENTATION.md  # PNG export 구현 상세 문서
├── n8n-workflow-template.json    # n8n 워크플로우 템플릿 (원클릭 import)
├── N8N_QUICKSTART.md             # n8n 빠른 시작 가이드 (5분)
└── N8N_WORKFLOW_GUIDE.md         # n8n 이메일 연동 완벽 가이드
```

## 🛠️ 기술 스택

- **HTML5**: 구조 및 마크업
- **CSS3**: 스타일링 및 애니메이션
  - Glassmorphism 디자인
  - 다크 모드 테마
  - 반응형 레이아웃
- **JavaScript (ES6+)**: 핵심 로직
  - 이벤트 처리
  - 데이터 분석 알고리즘
  - localStorage를 통한 최근 파일 관리
  - Canvas API를 통한 PNG 이미지 생성
- **Chart.js**: 데이터 시각화
- **PapaParse**: CSV 파일 파싱

## 📖 사용 가이드

### 1️⃣ 데이터 업로드

1. "데이터 업로드" 탭에서 CSV 파일을 드래그 앤 드롭하거나 클릭하여 선택
2. 자동으로 컬럼이 매핑되며, 필요시 수동으로 조정
3. 필수 컬럼 (타임스탬프, 사용자 ID, 이벤트 이름) 매핑 확인
4. "매핑 확인 및 데이터 처리" 버튼 클릭
5. **🆕 진행률 바**를 통해 처리 상황 실시간 확인:
   - 이전 결과 초기화 중... (10%)
   - 컬럼 매핑 중... (30%)
   - 데이터 처리 중... (50%)
   - 이벤트 선택기 설정 중... (70%)
   - 데이터 유형 감지 중... (85%)
   - 인사이트 생성 중... (95%)
   - 완료! (100%)
6. **🆕 자동 감지**: 이커머스 또는 구독 서비스 유형 자동 인식 및 알림
7. **🆕 자동 인사이트 생성**: 업로드 즉시 전체 데이터 기반 인사이트 자동 생성

### 2️⃣ 퍼널 분석

1. "퍼널 분석" 탭으로 이동
2. **🆕 자동 템플릿 적용**: 감지된 데이터 유형에 따라 퍼널 템플릿 자동 로드
3. 템플릿 선택 또는 직접 이벤트 선택하여 퍼널 구성
4. "퍼널 계산" 버튼 클릭
5. 결과를 차트와 테이블로 확인

### 3️⃣ 리텐션 분석

1. "리텐션 코호트" 탭으로 이동
2. 코호트 이벤트 (첫 이벤트) 선택
3. 활성 이벤트 (재방문 이벤트) 선택 (Ctrl/Cmd로 다중 선택)
4. "리텐션 계산" 버튼 클릭
5. 코호트 매트릭스 및 리텐션 곡선 확인

### 4️⃣ 세그먼트 비교

1. "세그먼트 비교" 탭으로 이동
2. 먼저 퍼널을 계산해야 함
3. 비교할 플랫폼 또는 채널 선택
4. "세그먼트 비교" 버튼 클릭
5. 세그먼트별 전환율 비교

### 5️⃣ 인사이트 확인

1. "인사이트 카드" 탭으로 이동
2. **🆕 자동 생성**: 데이터 업로드 즉시 전체 데이터 기반 인사이트 자동 생성
3. 각 인사이트 카드에서 다음 정보 확인:
   - 주요 발견 사항 및 메트릭
   - 상세 분석
   - 권장 조치 사항
4. 추가 퍼널 또는 리텐션 분석 후 새로운 인사이트도 자동 추가됨

### 6️⃣ 리포트 내보내기 (PNG)

1. "인사이트 카드" 탭으로 이동
2. **"📷 리포트 다운로드 (PNG)"** 버튼 클릭
3. 자동으로 리포트가 PNG 이미지로 생성됨:
   - **일반 브라우저**: PNG 파일 자동 다운로드 (`analysis_report_YYYYMMDD_HHMM_page_1.png`)
   - **제한 환경** (iframe/webview/iOS): 새 탭에 이미지 열림 → 이미지 길게 눌러 저장/공유
4. 리포트가 길 경우 여러 페이지로 자동 분할됨 (page_1, page_2, page_3...)
5. 각 페이지에는 다음 내용이 포함됨:
   - 데이터 요약 (행수, 사용자수, 날짜 범위)
   - 퍼널 분석 결과 + 차트
   - 리텐션 코호트 요약 + 차트
   - 세그먼트 비교 결과 + 차트
   - 핵심 인사이트

### 7️⃣ n8n 이메일 발송 (선택사항)

#### 초기 설정 (1회만)

1. n8n 워크플로우 생성 (상세: [N8N_WORKFLOW_GUIDE.md](./N8N_WORKFLOW_GUIDE.md))
2. \"인사이트 카드\" 탭에서 **\"⚙️ 이메일 설정\"** 클릭
3. 설정 입력:
   - **n8n Webhook URL**: n8n 워크플로우의 webhook URL
   - **수신 이메일 주소**: 리포트를 받을 이메일 (쉼표로 여러 주소 입력 가능)
   - **자동 발송**: 원하면 "분석 완료 시 자동으로 이메일 발송" 체크
4. **💾 설정 저장** 클릭
5. **🔍 연결 테스트**로 webhook 연결 확인

#### 이메일 발송

1. 데이터 분석 완료 후 \"인사이트 카드\" 탭으로 이동
2. **\"📧 이메일로 발송\"** 버튼 클릭
3. n8n이 지정된 이메일 주소로 리포트 발송
4. 이메일에는 다음이 포함됨:
   - HTML 형식 리포트 요약
   - PNG 이미지 첨부파일 (여러 페이지)

## 💾 데이터 저장

- **최근 파일**: 브라우저의 localStorage에 최대 5개 파일 저장
- **페이지 새로고침**: 최근 파일 목록 유지
- **파일 삭제**: 각 파일의 ✕ 버튼으로 목록에서 제거 가능

## 🎨 디자인 특징

- **다크 모드**: 눈의 피로를 줄이는 어두운 테마
- **그라디언트 액센트**: 시각적 계층 구조 강조
- **Glassmorphism**: 반투명 블러 효과로 현대적인 느낌
- **마이크로 애니메이션**: 호버, 클릭 시 부드러운 전환 효과
- **반응형**: 모바일, 태블릿, 데스크톱 모두 지원

## 🔧 브라우저 호환성

- Chrome (권장)
- Firefox
- Safari
- Edge

**최신 버전의 모던 브라우저 사용을 권장합니다.**

## 📝 라이선스

이 프로젝트는 개인 및 상업적 용도로 자유롭게 사용할 수 있습니다.

## 🤝 기여

버그 리포트, 기능 제안, 개선 사항은 언제든 환영합니다!

---

**Made with ❤️ for data-driven decision making**
